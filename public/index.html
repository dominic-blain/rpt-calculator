<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Welcome to Firebase Hosting</title>

    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:700,700i|Roboto:300,300i,500,500i" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/5.3.0/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/5.3.0/firebase-auth.js"></script>
    <script defer src="/__/firebase/5.3.0/firebase-firestore.js"></script>
    <script defer src="/__/firebase/5.3.0/firebase-messaging.js"></script>
    <script defer src="/__/firebase/5.3.0/firebase-storage.js"></script>
    <!-- initialize the SDK after all desired features are loaded -->
    <script defer src="/__/firebase/init.js"></script>
    <!-- JQuery -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  </head>
  <body>

  <header>
    
  </header>
  <main class="module-day-list" data-user="undefined">
    <div class="module-day-list--grid">
      <div class="module-day-list--grid-item">
      <section class="card-day js-day" data-day="1">
          <header class="card-day--title">Day 1</header>
          <main>
            <!-- Deadlift -->
            <div class="card-exercise js-exercise" data-exercise="deadlift" data-goal="6" data-sets="2" data-breakdown="0.1" data-record="185">
              <header class="card-exercise--title">Deadlift <span class="card-exercise--goal">Goal: 6</span></header>
              <div class="card-set js-set" data-set="1">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="8"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="185"/>
                </div>
                <div>lbs</div>
              </div>
              <div class="card-set js-set" data-set="2">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="11"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="165"/>
                </div>
                <div>lbs</div>
              </div>
            </div>
            <!-- Overhead press -->
            <div class="card-exercise js-exercise" data-exercise="overhead-press" data-goal="8" data-sets="3" data-breakdown="0.05" data-record="75">
              <header class="card-exercise--title">Overhead press <span class="card-exercise--goal">Goal: 8</span></header>
              <div class="card-set js-set" data-set="1">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="8"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="75"/>
                </div>
                <div>lbs</div>
              </div>
              <div class="card-set js-set" data-set="2">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="8"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="70"/>
                </div>
                <div>lbs</div>
              </div>
              <div class="card-set js-set" data-set="3">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="8"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="65"/>
                </div>
                <div>lbs</div>
              </div>
            </div>
            <!-- Pressdown -->
            <div class="card-exercise js-exercise" data-exercise="pressdown" data-goal="10" data-sets="2" data-breakdown="0.1" data-record="70">
              <header class="card-exercise--title">Pressdown <span class="card-exercise--goal">Goal: 10</span></header>
              <div class="card-set js-set" data-set="1">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="14"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="70"/>
                </div>
                <div>lbs</div>
              </div>
              <div class="card-set js-set" data-set="2">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="14"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="60"/>
                </div>
                <div>lbs</div>
              </div>
            </div>
          </main>
          <footer class="card-day--footer">
            <button class="card-day--button js-button-done">Done</button>
          </footer>
        </section>
      </div>
      <div class="module-day-list--grid-item">
        <section class="card-day js-day" data-day="2">
          <header class="card-day--title">Day 2</header>
          <main>
            <!-- Bench press -->
            <div class="card-exercise js-exercise" data-exercise="bench-press" data-goal="8" data-sets="3" data-breakdown="0.1" data-record="">
              <header class="card-exercise--title">Bench press <span class="card-exercise--goal">Goal: 8</span></header>
              <div class="card-set js-set" data-set="1">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="0"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="000"/>
                </div>
                <div>lbs</div>
              </div>
              <div class="card-set js-set" data-set="2">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="0"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="000"/>
                </div>
                <div>lbs</div>
              </div>
              <div class="card-set js-set" data-set="3">
                  <div class="card-set--input-ctn card-set--reps js-reps">
                    <input type="number" name="reps" id="reps" placeholder="0"/>
                  </div>
                  <div class="card-set--multiplier">x</div>
                  <div class="card-set--input-ctn card-set--weight js-weight">
                    <input type="number" name="weight" id="weight" placeholder="000"/>
                  </div>
                  <div>lbs</div>
                </div>
            </div>
            <!-- Row -->
            <div class="card-exercise js-exercise" data-exercise="row" data-goal="8" data-sets="3" data-breakdown="0.1" data-record="">
              <header class="card-exercise--title">Row <span class="card-exercise--goal">Goal: 8</span></header>
              <div class="card-set js-set" data-set="1">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="0"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="000"/>
                </div>
                <div>lbs</div>
              </div>
              <div class="card-set js-set" data-set="2">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="0"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="000"/>
                </div>
                <div>lbs</div>
              </div>
              <div class="card-set js-set" data-set="3">
                  <div class="card-set--input-ctn card-set--reps js-reps">
                    <input type="number" name="reps" id="reps" placeholder="0"/>
                  </div>
                  <div class="card-set--multiplier">x</div>
                  <div class="card-set--input-ctn card-set--weight js-weight">
                    <input type="number" name="weight" id="weight" placeholder="000"/>
                  </div>
                  <div>lbs</div>
                </div>
            </div>
            <!-- Curls -->
            <div class="card-exercise js-exercise" data-exercise="curls" data-goal="10" data-sets="2" data-breakdown="0.1" data-record="">
              <header class="card-exercise--title">Curls <span class="card-exercise--goal">Goal: 10</span></header>
              <div class="card-set js-set" data-set="1">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="0"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="000"/>
                </div>
                <div>lbs</div>
              </div>
              <div class="card-set js-set" data-set="2">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="0"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="000"/>
                </div>
                <div>lbs</div>
              </div>
            </div>
          </main>
          <footer class="card-day--footer">
            <button class="card-day--button js-button-done">Done</button>
          </footer>
        </section>
      </div>
      <div class="module-day-list--grid-item">
        <section class="card-day js-day" data-day="3">
          <header class="card-day--title">Day 3</header>
          <main>
            <!-- Squats -->
            <div class="card-exercise js-exercise" data-exercise="squats" data-goal="10" data-sets="3" data-breakdown="0.1" data-record="">
              <header class="card-exercise--title">Squats <span class="card-exercise--goal">Goal: 10</span></header>
              <div class="card-set js-set" data-set="1">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="0"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="000"/>
                </div>
                <div>lbs</div>
              </div>
              <div class="card-set js-set" data-set="2">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="0"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="000"/>
                </div>
                <div>lbs</div>
              </div>
              <div class="card-set js-set" data-set="3">
                  <div class="card-set--input-ctn card-set--reps js-reps">
                    <input type="number" name="reps" id="reps" placeholder="0"/>
                  </div>
                  <div class="card-set--multiplier">x</div>
                  <div class="card-set--input-ctn card-set--weight js-weight">
                    <input type="number" name="weight" id="weight" placeholder="000"/>
                  </div>
                  <div>lbs</div>
                </div>
            </div>
            <!-- Chin Up -->
            <div class="card-exercise js-exercise" data-exercise="chin-up" data-goal="8" data-sets="3" data-breakdown="0.1" data-record="">
              <header class="card-exercise--title">Chin-Up <span class="card-exercise--goal">Goal: 8</span></header>
              <div class="card-set js-set" data-set="1">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="0"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="000"/>
                </div>
                <div>lbs</div>
              </div>
              <div class="card-set js-set" data-set="2">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="0"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="000"/>
                </div>
                <div>lbs</div>
              </div>
              <div class="card-set js-set" data-set="3">
                  <div class="card-set--input-ctn card-set--reps js-reps">
                    <input type="number" name="reps" id="reps" placeholder="0"/>
                  </div>
                  <div class="card-set--multiplier">x</div>
                  <div class="card-set--input-ctn card-set--weight js-weight">
                    <input type="number" name="weight" id="weight" placeholder="000"/>
                  </div>
                  <div>lbs</div>
                </div>
            </div>
            <!-- Leg Curls -->
            <div class="card-exercise js-exercise" data-exercise="curls" data-goal="10" data-sets="2" data-breakdown="0.1" data-record="">
              <header class="card-exercise--title">Leg Curls <span class="card-exercise--goal">Goal: 10</span></header>
              <div class="card-set js-set" data-set="1">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="0"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="000"/>
                </div>
                <div>lbs</div>
              </div>
              <div class="card-set js-set" data-set="2">
                <div class="card-set--input-ctn card-set--reps js-reps">
                  <input type="number" name="reps" id="reps" placeholder="0"/>
                </div>
                <div class="card-set--multiplier">x</div>
                <div class="card-set--input-ctn card-set--weight js-weight">
                  <input type="number" name="weight" id="weight" placeholder="000"/>
                </div>
                <div>lbs</div>
              </div>
            </div>
          </main>
          <footer class="card-day--footer">
            <button class="card-day--button js-button-done">Done</button>
          </footer>
        </section>
      </div>
    </div>
  </main>
        

    <script>


      document.addEventListener('DOMContentLoaded', function() {
        const db = firebase.firestore(),
              settings = {timestampsInSnapshots: true};
        db.settings(settings);

        var completeDay = function () {
          var logs = db.batch(),
              day = $(this).closest('.js-day'),
              exercises = day.find('.js-exercise');

          exercises.each(function () {
            var exercise = $(this),
                sets = exercise.find('.js-set');

            sets.each(function () {
              var set = $(this),
                  reps = parseInt(set.find('.js-reps input').val()) || 0,
                  weight = parseInt(set.find('.js-weight input').val()) || 0,
                  logRef = db.collection('logs').doc(); 
              
              if (weight && reps) {
                console.log('Adding set to batch '+ reps +' x '+ weight);
                logs.set(logRef, {
                  timestamp: new Date(),
                  user: 1,
                  set: set.data('set') || 0,
                  exercise: exercise.data('exercise') || 0,
                  day: day.data('day') || 0,
                  program: 1,
                  reps: reps,
                  weight: weight
                });
              }
              else {
                console.log('No action taken, set is empty');
              }
            });
          });

          logs.commit().then(function () {
            console.log('Data has been saved!');
          });
          
        };

        var populatePlaceholders = function () {
          var sets = $('.js-set');
          sets.each(function () {
            var set = $(this),
                setId = set.data('set'),
                exerciseId = set.closest('.js-exercise').data('exercise'),
                dayId = set.closest('.js-day').data('day'),
                reps = set.find('.js-reps input'),
                weight = set.find('.js-weight input'),
                logsRef = db.collection('logs'),
                logQuery = logsRef
                          .where('day', '==', dayId)
                          .where('exercise', '==', exerciseId)
                          .where('set', '==', setId)
                          .orderBy('timestamp', 'desc')
                          .limit(1);
            logQuery.get().then(function (logSnapshot) {
              logSnapshot.forEach(function(log) {
                var data = log.data(),
                    repsVal = data.reps,
                    weightVal = data.weight;
                reps.attr('placeholder', repsVal);
                weight.attr('placeholder', weightVal);
              });
            }).catch(function(error) {
              console.log("Error getting log:", error);
            }); 
          });
        };

        var init = function () {
          populatePlaceholders();
          $('.js-button-done').on('click', completeDay);
        };

        init();
      });
    </script>
  </body>
</html>
